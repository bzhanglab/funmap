function uncollapse_children(a,b){const c=b.includes(a.name);if(a.children&&a.children.length>0){let d=false;for(let e=0;e<a.children.length;e++){if(b.includes(a.children[e].name)){x=uncollapse_children(a.children[e],b);a.children[e]=x[0];d=d||x[1]}}if(d){a.collapsed=false}}return[a,c]}function toTitleCase(f){return f.replace(/\w\S*/g,g=>g.charAt(0).toUpperCase()+g.substr(1).toLowerCase())}function funmap(h,i={}){const j=i.gene_json||"../data/genes.json";const k=i.gene_element||"genes";const l=i.gene_to_module||"../data/gene_to_module.json";const m=i.go_json||"../data/go.json";const n=i.funmap_json||"../data/funmap.json";const o=i.main_chart||"chart";const p=i.pie_chart||"pie_chart";let q=0;fetch(j).then(r=>r.json()).then(s=>{genelist=document.getElementById(k);for(let t=0;t<s.length;t++){const u=document.createElement("option");u.value=s[t];genelist.appendChild(u)}}).then(()=>{fetch(l).then(v=>v.json()).then(w=>{fetch(m).then(y=>y.json()).then(z=>{fetch(n).then(A=>A.json()).then(B=>{function C(M){if(M.children&&M.children.length>0){for(let N=0;N<M.children.length;N++){C(M.children[N])}}if(M.size<=50){M.label={fontWeight:"bold"}}}C(B);const D={title:{text:"FunMap Hierarchal Organization",left:"center",textStyle:{fontSize:30,fontWeight:"bolder",color:"#333"}},tooltip:{trigger:"item",triggerOn:"mousemove",confine:true,formatter:(O,P,Q)=>{node_go=z[O.name];let R="";if("hallmarks"in O.data){for(let U=0;U<O.data.hallmarks.length;U++){R+=toTitleCase(`${O.data.hallmarks[U]}, `)}R=R.slice(0,-2)}if(R===""){R="No Hallmarks"}const S=`<h5 style="max-width: 100%; text-align:center; word-break: normal; white-space: normal;">${O.name}</h5><h6 style="max-width: 100%; text-align:center; word-break: normal; white-space: normal">Cancer Hallmarks: ${R}</h6><br><h6 style="text-align:center;">Top GO Terms</h6><table style="width: 100%" class="tooltip_table"><thead><tr><th>GO Category</th><th>GO ID</th><th>Name</th><th>p-Value</th></tr></thead><tbody><tr><td>Biological Process</td><td>${node_go.gobp.id}</td><td>${node_go.gobp.name}</td><td>${node_go.gobp.p==="0"?"< 2.20e-16":parseFloat(node_go.gobp.p).toExponential(2)}</td></tr><tr><td>Cellular Component</td><td>${node_go.gocc.id}</td><td>${node_go.gocc.name}</td><td>${node_go.gocc.p==="0"?"< 2.20e-16":parseFloat(node_go.gocc.p).toExponential(2)}</td></tr><tr><td>Molecular Function</td><td>${node_go.gomf.id}</td><td>${node_go.gomf.name}</td><td>${node_go.gomf.p==="0"?"< 2.20e-16":parseFloat(node_go.gomf.p).toExponential(2)}</td></tr></tbody></table>`;const T=document.createElement("div");T.innerHTML=S;T.style.maxWidth="100%";T.style.textAlign="center";T.style.fontSize="0.55vw";T.style.lineHeight="0.5vw";return T},extraCssText:"max-width: 30%;",className:"tooltip"},toolbox:{show:true,feature:{restore:{},saveAsImage:{}}},series:[{type:"tree",roam:true,name:"FunMap",data:[B],top:"10%",bottom:"10%",left:"10%",right:"10%",layout:"radial",symbol:(V,W)=>{node=W.data;if(node.children&&node.children.length>0&&W.collapsed){return"diamond"}return"circle"},symbolSize:(X,Y)=>{node=Y.data;return node.name==="L1_M1"?51:.0273*node.size+19.454},initialTreeDepth:1,label:{position:"top",verticalAlign:"middle",align:"right",fontSize:12},leaves:{label:{position:"bottom",verticalAlign:"middle",align:"left"}},animationDuration:550,animationDurationUpdate:750,lineStyle:{width:7,color:"yellow"},itemStyle:{borderWidth:1,color:"yellow",borderColor:"black"},emphasis:{focus:"ancestor"}}],visualMap:{type:"continuous",min:-165,max:165,seriesIndex:0,title:{text:"Signed log10 meta-p",left:"center",top:"bottom"},text:["Signed log10 meta-p\n\nHigher in Tumor vs. Normal","Lower in Tumor vs. Normal"],precision:3,inRange:{color:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"].reverse()}}};const E=h.init(document.getElementById(o));E.setOption(D);window.addEventListener("resize",()=>{E.resize()});const F=document.getElementById(p);const G=h.init(F);const H={title:{text:"Hallmark Key",left:"center"},series:[{animationDuration:0,animationDurationUpdate:0,name:"Hallmark Key",type:"pie",radius:["40%","70%"],avoidLabelOverlap:false,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:false,position:"center"},emphasis:{animationDuration:50,label:{show:true,width:200,fontSize:18,fontWeight:"bold",overflow:"break"}},labelLine:{show:false},data:[{name:"EVADING GROWTH SUPPRESSORS",value:1,itemStyle:{color:"rgba(96, 50, 2, 0.55)"}},{name:"AVOIDING IMMUNE DESTRUCTION",value:1,itemStyle:{color:"rgba(194, 0, 126, 0.55)"}},{name:"ENABLING REPLICATIVE IMMORTALITY",value:1,itemStyle:{color:"rgba(13, 104, 161, 0.55)"}},{name:"TUMOR PROMOTING INFLAMMATION",value:1,itemStyle:{color:"rgba(213, 101, 23, 0.55)"}},{name:"ACTIVATING INVASION AND METASTASIS",value:1,itemStyle:{color:"rgba(25, 23, 24, 0.55)"}},{name:"INDUCING ANGIOGENESIS",value:1,itemStyle:{color:"rgba(232, 35, 40, 0.55)"}},{name:"GENOME INSTABILITY AND MUTATION",value:1,itemStyle:{color:"rgba(21, 41, 132, 0.55)"}},{name:"RESISTING CELL DEATH",value:1,itemStyle:{color:"rgba(112, 125, 134, 0.55)"}},{name:"DEREGULATING CELLULAR ENERGETICS",value:1,itemStyle:{color:"rgba(106, 42, 133, 0.55)"}},{name:"SUSTAINING PROLIFERATIVE SIGNALING",value:1,itemStyle:{color:"rgba(21, 143, 72, 0.55)"}},{name:"NONE",value:1,itemStyle:{color:"rgba(220, 211, 182, 0.55)"}}]}]};H&&G.setOption(H);const I=create_dag(h,"hierarchal_modules","L2_M2","dag",false,"../");let J=null;I.then(Z=>{J=Z;E.on("mouseover",$=>{update_dag_chart($.name)})});update_dag_chart=(_,aa=null)=>{const ba=update_dag(J,"hierarchal_modules",_,"../");ba.then(ca=>{q++;if(ca){J=ca;if(!is_open["dag-tab-container"]){dagTabContainer.dispatchEvent(new Event("click"))}if(aa!=null){J.dispatchAction({type:"highlight",seriesIndex:0,name:aa})}}else{if(!is_open["dag-tab-container"]){dagTabContainer.dispatchEvent(new Event("click"))}setTimeout(da=>{if(is_open["dag-tab-container"]&&da===q){dagTabContainer.dispatchEvent(new Event("click"))}},2e3,q)}})};function K(){G.resize({width:F.clientWidth,height:F.clientHeight,animation:{duration:500}});setTimeout(()=>{G.clear();G.setOption(H,true)},1)}new ResizeObserver(K).observe(F);G.on("mouseover",ea=>{const fa=[];for(let ga=0;ga<D.series[0].data[0].children.length;ga++){if(D.series[0].data[0].children[ga].hallmarks[0]===ea.name){fa.push(D.series[0].data[0].children[ga].name)}else if(ea.name==="NONE"&&D.series[0].data[0].children[ga].hallmarks.length===0){fa.push(D.series[0].data[0].children[ga].name)}}E.dispatchAction({type:"highlight",seriesIndex:0,name:fa})});const L=document.getElementById("search_button");L.addEventListener("click",ha=>{const ia=document.getElementById("gene_search").value;if(ia in w){const ja=w[ia];let ka=D.series[0].data[0];ka=uncollapse_children(ka,ja)[0];const la=D;la.series[0].data[0]=ka;E.setOption(la);E.dispatchAction({type:"highlight",seriesIndex:0,name:ja});const ma=document.getElementById("search_msg");ma.className="search_info";ma.innerHTML=`Gene found in modules: ${ja.join(", ")}.`;update_dag_chart(ja[ja.length-1],ia)}else{const na=document.getElementById("search_msg");na.className="search_error";na.innerHTML="Gene not found in any module."}})})})})})}