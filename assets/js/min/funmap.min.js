function uncollapse_children(a,b){let c=b.includes(a.name);if(a.children&&a.children.length>0){let d=false;for(let e=0;e<a.children.length;e++){if(b.includes(a.children[e].name)){x=uncollapse_children(a.children[e],b);a.children[e]=x[0];d=d||x[1]}}if(d){a.collapsed=false}}return[a,c]}function toTitleCase(f){return f.replace(/\w\S*/g,function(g){return g.charAt(0).toUpperCase()+g.substr(1).toLowerCase()})}function funmap(h,i={}){let j=i.gene_json||"../data/genes.json";let k=i.gene_element||"genes";let l=i.gene_to_module||"../data/gene_to_module.json";let m=i.go_json||"../data/go.json";let n=i.funmap_json||"../data/funmap.json";let o=i.main_chart||"chart";let p=i.pie_chart||"pie_chart";fetch(j).then(q=>q.json()).then(r=>{genelist=document.getElementById(k);for(let s=0;s<r.length;s++){let t=document.createElement("option");t.value=r[s];genelist.appendChild(t)}}).then(()=>{fetch(l).then(u=>u.json()).then(v=>{fetch(m).then(w=>w.json()).then(y=>{fetch(n).then(z=>z.json()).then(A=>{function B(L){if(L.children&&L.children.length>0){for(let M=0;M<L.children.length;M++){B(L.children[M])}}if(L.size<=50){L.label={fontWeight:"bold"}}}B(A);var C={title:{text:"FunMap Hierarchal Organization",left:"center",textStyle:{fontSize:30,fontWeight:"bolder",color:"#333"}},tooltip:{trigger:"item",triggerOn:"mousemove",formatter:function(N,O,P){node_go=y[N.name];let Q="";if("hallmarks"in N.data){for(let T=0;T<N.data.hallmarks.length;T++){Q+=toTitleCase(N.data.hallmarks[T])+", "}Q=Q.slice(0,-2)}if(Q==""){Q="No Hallmarks"}var R=`<h1 style="text-align:center;">${N.name}</h1><h2>Cancer Hallmarks: ${Q}</h2><br><h3 style="text-align:center;">Top GO Terms</h3><table style="width: 100%"><thead><tr><th>GO Category</th><th>GO ID</th><th>Name</th><th>p-Value</th></tr></thead><tbody><tr><td>Biological Process</td><td>${node_go["gobp"]["id"]}</td><td>${node_go["gobp"]["name"]}</td><td>${node_go["gobp"]["p"]}</td></tr><tr><td>Cellular Component</td><td>${node_go["gocc"]["id"]}</td><td>${node_go["gocc"]["name"]}</td><td>${node_go["gocc"]["p"]}</td></tr><tr><td>Molecular Function</td><td>${node_go["gomf"]["id"]}</td><td>${node_go["gomf"]["name"]}</td><td>${node_go["gomf"]["p"]}</td></tr></tbody></table>`;let S=document.createElement("div");S.innerHTML=R;return S}},toolbox:{show:true,feature:{restore:{},saveAsImage:{}}},series:[{type:"tree",roam:true,name:"FunMap",data:[A],top:"10%",bottom:"10%",left:"10%",right:"10%",layout:"radial",symbol:(U,V)=>{node=V.data;if(node.children&&node.children.length>0&&V.collapsed){return"diamond"}else{return"circle"}},symbolSize:(W,X)=>{node=X.data;return node.name=="L1_M1"?51:.0273*node.size+19.454},initialTreeDepth:1,label:{position:"top",verticalAlign:"middle",align:"right",fontSize:12},leaves:{label:{position:"bottom",verticalAlign:"middle",align:"left"}},animationDuration:550,animationDurationUpdate:750,lineStyle:{width:7,color:"yellow"},itemStyle:{borderWidth:1,color:"yellow",borderColor:"black"},emphasis:{focus:"ancestor"}}],visualMap:{type:"continuous",min:-165,max:165,seriesIndex:0,title:{text:"Signed log10 meta-p",left:"center",top:"bottom"},text:["Signed log10 meta-p\n\nHigher in Tumor vs. Normal","Lower in Tumor vs. Normal"],precision:3,inRange:{color:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"].reverse()}}};var D=h.init(document.getElementById(o));D.setOption(C);window.addEventListener("resize",function(){D.resize()});var E=document.getElementById(p);var F=h.init(E);var G;G={title:{text:"Hallmark Key",left:"center"},series:[{animationDuration:0,animationDurationUpdate:0,name:"Hallmark Key",type:"pie",radius:["40%","70%"],avoidLabelOverlap:false,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:false,position:"center"},emphasis:{animationDuration:50,label:{show:true,width:200,fontSize:18,fontWeight:"bold",overflow:"break"}},labelLine:{show:false},data:[{name:"EVADING GROWTH SUPPRESSORS",value:1,itemStyle:{color:"rgba(96, 50, 2, 0.55)"}},{name:"AVOIDING IMMUNE DESTRUCTION",value:1,itemStyle:{color:"rgba(194, 0, 126, 0.55)"}},{name:"ENABLING REPLICATIVE IMMORTALITY",value:1,itemStyle:{color:"rgba(13, 104, 161, 0.55)"}},{name:"TUMOR PROMOTING INFLAMMATION",value:1,itemStyle:{color:"rgba(213, 101, 23, 0.55)"}},{name:"ACTIVATING INVASION AND METASTASIS",value:1,itemStyle:{color:"rgba(25, 23, 24, 0.55)"}},{name:"INDUCING ANGIOGENESIS",value:1,itemStyle:{color:"rgba(232, 35, 40, 0.55)"}},{name:"GENOME INSTABILITY AND MUTATION",value:1,itemStyle:{color:"rgba(21, 41, 132, 0.55)"}},{name:"RESISTING CELL DEATH",value:1,itemStyle:{color:"rgba(112, 125, 134, 0.55)"}},{name:"DEREGULATING CELLULAR ENERGETICS",value:1,itemStyle:{color:"rgba(106, 42, 133, 0.55)"}},{name:"SUSTAINING PROLIFERATIVE SIGNALING",value:1,itemStyle:{color:"rgba(21, 143, 72, 0.55)"}},{name:"NONE",value:1,itemStyle:{color:"rgba(220, 211, 182, 0.55)"}}]}]};G&&F.setOption(G);let H=create_dag(h,"dense_modules","C195","dag",ignore_size=false,host="../");let I=null;H.then(Y=>{I=Y;D.on("mouseover",function(Z){update_dag_chart(Z.name)})});update_dag_chart=function($,_=null){let aa=update_dag(I,"hierarchal_modules",$,host="../");aa.then(ba=>{if(!!ba){I=ba;if(!has_shown_dag){dagTabContainer.style.display="block";dagContainer.style.display="block";has_shown_dag=true}dagTabContainer.dispatchEvent(new Event("mouseenter"));setTimeout(()=>{timeout_id+=1;dagTabContainer.dispatchEvent(new Event("mouseleave"))},1e3);if(_!=null){I.dispatchAction({type:"highlight",seriesIndex:0,name:_})}}else{dagTabContainer.style.display="none";dagContainer.style.display="none";dagContainer.style.right="-35.2%";dagTabContainer.style.right="-1.15%";has_shown_dag=false}})};function J(){F.resize({width:E.clientWidth,height:E.clientHeight,animation:{duration:500}});setTimeout(()=>{F.clear();F.setOption(G,true)},1)}new ResizeObserver(J).observe(E);F.on("mouseover",function(ca){let da=[];for(let ea=0;ea<C.series[0].data[0].children.length;ea++){if(C.series[0].data[0].children[ea].hallmarks[0]==ca.name){da.push(C.series[0].data[0].children[ea].name)}else if(ca.name=="NONE"&&C.series[0].data[0].children[ea].hallmarks.length==0){da.push(C.series[0].data[0].children[ea].name)}}D.dispatchAction({type:"highlight",seriesIndex:0,name:da})});let K=document.getElementById("search_button");K.addEventListener("click",function(fa){let ga=document.getElementById("gene_search").value;if(ga in v){let ha=v[ga];let ia=C.series[0].data[0];ia=uncollapse_children(ia,ha)[0];let ja=C;ja.series[0].data[0]=ia;D.setOption(ja);D.dispatchAction({type:"highlight",seriesIndex:0,name:ha});let ka=document.getElementById("search_msg");ka.className="search_info";ka.innerHTML=`Gene found in modules: ${ha.join(", ")}.`;update_dag_chart(ha[ha.length-1],ga)}else{let la=document.getElementById("search_msg");la.className="search_error";la.innerHTML="Gene not found in any module."}})})})})})}