<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>FunMap Hierarchical Organization</title>
    <script src="../assets/js/echarts.min.js"></script>
    <script src="../assets/js/min/dag.min.js"></script>
    <script src="../assets/js/min/funmap.min.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../assets/css/funmap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/gd.min.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="manifest" href="../site.webmanifest">
    <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <style>
        html {
            background: none;
        }

        .search_info {
            color: #000;
        }

        .search_error {
            color: #ff0000;
        }

        #search_msg {
            text-align: center;
            font-size: var(--unit);
        }
    </style>
</head>

<body>
    <div id="outer">
        <div id="chart" style="width: 100%; height: 100%"></div>
        <div id="legend-tab-container" class="tab-container"><b>∨</b> Legend</div>
        <div id="search-tab-container" class="tab-container"><b>∨</b> Search</div>
        <div id="dag-tab-container" class="tab-container">
            <b>∨</b> Graph
        </div>
        <div id="legend-container" class="side-container">
            <div id="legend">
                <!-- Content of the drawer -->
                <p>
                    Visualize and interact with the hierarchical structure
                    of
                    <a href="https://github.com/bzhanglab/funmap" target="_blank">FunMap</a>.<br /><br />
                    Click on collapsed nodes to view children. Hover over
                    nodes to see more information about the module.
                </p>
                <h3 style="text-align: center">Legend</h3>
                <ul style="list-style-type: none; line-height: 1.3">
                    <li>
                        <img class="svg" src="../assets/img/diamond.svg" />
                        Collapsed node
                    </li>
                    <li>
                        <img class="svg" src="../assets/img/circle.svg" />
                        Expanded node
                    </li>
                    <li><b>Fill Color</b> - Signed log10 meta-p value<sup><b style="color: red">*</b></sup></li>
                    <li><b>Edge Color</b> - Cancer hallmark</li>
                    <li><b>Node Size</b> - Number of genes in module</li>
                    <li><b>Label Boldness</b> - </b>bold</b> labels indicate node has displayable graph<sup><b
                                style="color: red">**</b></sup></li>
                </ul>
                <span style="font-size: 0.75vw; padding-bottom: 50%;"><sup><b style="color: red">*</b></sup> Meta-p
                    calculated by combining p values from five individual cancer cohorts</span>
                <br />
                <span style="font-size: 0.75vw; padding-bottom: 50%;"><sup><b style="color: red">**</b></sup> Due to
                    performance, only nodes
                    with &lt; 50 genes can be
                    displayed</span>
            </div>
        </div>
        <div id="search-container" class="side-container">
            <div id="search-area">
                <h6 style="text-align: center">
                    Search for Module Containing Gene
                </h6>
                <input list="genes" id="gene_search" placeholder="Search for a gene" style="width: 100%; height: 2em" />
                <datalist id="genes"></datalist>
                <button id="search_button" style="width: 100%; height: 2em">
                    Search
                </button>
                <p id="search_msg"></p>
            </div>
        </div>
        <div id="dag-container" class="side-container">
            <div id="dag-area" style="width: 100%; height: 100%">
                <div id="dag" style="width: 100%; height: 100%"></div>
            </div>
        </div>
        <div id="pie_chart_container">
            <div id="pie_chart_grey" style="width: 100%; height: 100%"></div>
            <div id="pie_chart" style="width: 100%; height: 100%"></div>
        </div>
    </div>
    <script>
        const legendContainer = document.getElementById("legend-container");
        const legendTabContainer = document.getElementById(
            "legend-tab-container",
        );
        const searchContainer = document.getElementById("search-container");
        const searchTabContainer = document.getElementById(
            "search-tab-container",
        );
        const dagContainer = document.getElementById("dag-container");
        const dagTabContainer =
            document.getElementById("dag-tab-container");

        const initial_timeout = 3000;
        const legend_timeout = 3000;
        const search_timeout = 3000;
        const dag_timeout = 3000;
        let timeout_id = 0;
        let is_open = {}
        setTimeout(() => {
            searchTabContainer.dispatchEvent(new Event("mouseleave"));
            legendTabContainer.dispatchEvent(new Event("mouseleave"));
        }, initial_timeout);

        registerMouseEvents = function (
            container,
            tab,
            start_open,
            direction,
            closed_container_pos,
            closed_tab_pos,
            open_container_pos,
            open_tab_pos,
        ) {

            container.style[direction] = closed_container_pos;
            tab.style[direction] = closed_tab_pos;
            const current_text = tab.innerHTML;
            tab.innerHTML = current_text.replace("∨", "∧");
            is_open[tab.id] = false;

            if (start_open) {
                setTimeout(() => {
                    tab.click();
                }, 1000);
            }

            tab.addEventListener("click", () => {
                if (is_open[tab.id]) {
                    container.style[direction] = closed_container_pos;
                    tab.style[direction] = closed_tab_pos;
                    const current_text = tab.innerHTML;
                    tab.innerHTML = current_text.replace("∨", "∧");
                    is_open[tab.id] = false;
                } else {
                    container.style[direction] = open_container_pos;
                    tab.style[direction] = open_tab_pos;
                    const current_text = tab.innerHTML;
                    tab.innerHTML = current_text.replace("∧", "∨");
                    is_open[tab.id] = true;
                }
            }
            )
        };

        registerMouseEvents(
            legendContainer, // contaier
            legendTabContainer, // tab
            true, // start_open
            "left", // direction
            "-22.2%", // closed_container_pos
            "-1.55%", // closed_tab_pos
            "0", // open_container_pos
            "20.55%", // open_tab_pos
        );
        registerMouseEvents(
            searchContainer,
            searchTabContainer,
            true,
            "right",
            "-23.2%",
            "-1.55%",
            "0",
            "21.65%",
        );
        registerMouseEvents(
            dagContainer,
            dagTabContainer,
            false,
            "right",
            "-35.2%",
            "-1.35%",
            "0",
            "33.75%",
        );

        funmap(echarts);
    </script>
</body>

</html>